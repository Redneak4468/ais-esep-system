{% extends "base.html" %}
{% block title %}Список сотрудников{% endblock %}
{% block content %}
<div class="container mt-2">
    <h2>Эсептөө палатасынын кызматкерлердин тизмеси</h2>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Фильтр по отделу -->
        <form method="get" class="d-flex">
            <select name="office" class="form-select me-2" onchange="this.form.submit()">
                <option value="">Баарын көрсөтүү</option>
                {% for off in offices %}
                <option value="{{ off.id }}"
                        {% if off.id|stringformat:'s' == selected_office %}selected{% endif %}>
                {{ off.name }}
                </option>
                {% endfor %}
            </select>
            <noscript>
                <button type="submit" class="btn btn-primary"><i class="fa-solid fa-magnifying-glass"></i></button>
            </noscript>
        </form>
        <form method="get" class="d-flex" role="search">
            <input
                    type="text"
                    name="q"
                    value="{{ request.GET.q }}"
                    class="form-control me-2"
                    placeholder="Аты-жөнү менен издөө">
            <button class="btn btn-outline-primary" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
        </form>
    </div>

    <table class="table table-striped table-hover text-center align-middle ">
        <thead class="table-primary">
        <tr>
            <th>Аты-жөнү</th>
            <th>Кызмат орду</th>
            <th>email (esep)</th>
            <th>Статус</th>
        </tr>
        </thead>
        <tbody>
        {% for employee in employees %}
        <tr onclick="window.location='{% url 'employee_detail' employee.pk %}'" style="cursor:pointer;">
            <td class="text-start d-flex align-items-center">
                {% if employee.office_id == 1 %}
                <span class="office-marker office-green"></span>
                {% elif employee.office_id == 2 %}
                <span class="office-marker office-yellow"></span>
                {% elif employee.office_id == 3 %}
                <span class="office-marker office-blue"></span>
                {% elif employee.office_id == 4 %}
                <span class="office-marker office-red"></span>
                {% endif %}
                {{ employee.last_name }} {{ employee.first_name }} {{ employee.patronymic }}
            </td>
            <td>{{ employee.position.title }}</td>
            <td>{{ employee.email }}</td>
            <td> {% if employee.status == 'active' %}
                <span class="badge bg-success">{{ employee.get_status_display }}</span>
                {% elif employee.status == 'vacation' %}
                <span class="badge bg-info">{{ employee.get_status_display }}</span>
                {% elif employee.status == 'fired' %}
                <span class="badge bg-danger">{{ employee.get_status_display }}</span>
                {% else %}
                {{ employee.get_status_display }}
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">Нет сотрудников</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}