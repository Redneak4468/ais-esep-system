{% extends "base.html" %}

{% block content %}
<div class="container mt-3">
    <h4 class="mb-4 text-center">
        Кыргыз Республикасынын Эсептөө палатасынын Борбордук аппаратынын
        кызматкерлеринин телефондорунун жана отурган кабинеттеринин маалымдамасы
    </h4>

    <table class="table table-striped table-hover text-center align-middle">
        <thead class="table-primary">
        <tr>
            <th>ФИО</th>
            <th>Должность</th>
            <th>Служебный</th>
            <th>Внутренний</th>
            <th>Мобильный</th>
            <th>Кабинет</th>
        </tr>
        </thead>
        <tbody>
        {% for dept in departments %}
        <!-- Заголовок департамента -->
        <tr class="table-secondary" data-bs-toggle="collapse" data-bs-target=".dept-{{ dept.id }}"
            style="cursor:pointer;">
            <td colspan="6" class="text-start fw-bold">
                {{ dept.name }}
            </td>
        </tr>

        {% with dept_employees=False %}
        {% for pos in dept.positions.all %}
        {% for contact in pos.profiles.all %}
        {% with True as dept_employees %}{% endwith %}
        <tr class="collapse show dept-{{ dept.id }}">
            <td class="text-start">{{ contact.last_name }} {{ contact.first_name }} {{ contact.patronymic }}</td>
            <td>{{ pos.title }}</td>
            <td>{{ contact.phone_number_work }}</td>
            <td>{{ contact.phone_number_government }}</td>
            <td>{{ contact.phone_number_mobile }}</td>
            <td>{{ contact.office_number }}</td>
        </tr>
        {% endfor %}
        {% endfor %}

        {% if not dept.positions.all|length or not dept.positions.all.0.profiles.exists %}
        <tr class="collapse show dept-{{ dept.id }}">
            <td colspan="6" class="text-muted">Сотрудников нет</td>
        </tr>
        {% endif %}
        {% endwith %}
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
