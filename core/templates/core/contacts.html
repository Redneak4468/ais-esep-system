{% extends "base.html" %}
{% load i18n %}
{% block content %}
<div class="container mt-3">
    <h4 class="mb-4 text-center">
        {% trans '–ö—ã—Ä–≥—ã–∑ –†–µ—Å–ø—É–±–ª–∏–∫–∞—Å—ã–Ω—ã–Ω –≠—Å–µ–ø—Ç”©”© –ø–∞–ª–∞—Ç–∞—Å—ã–Ω—ã–Ω –ë–æ—Ä–±–æ—Ä–¥—É–∫ –∞–ø–ø–∞—Ä–∞—Ç—ã–Ω—ã–Ω –∫—ã–∑–º–∞—Ç–∫–µ—Ä–ª–µ—Ä–∏–Ω–∏–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–¥–æ—Ä—É–Ω—É–Ω –∂–∞–Ω–∞ –æ—Ç—É—Ä–≥–∞–Ω –∫–∞–±–∏–Ω–µ—Ç—Ç–µ—Ä–∏–Ω–∏–Ω –º–∞–∞–ª—ã–º–¥–∞–º–∞—Å—ã' %}
    </h4>
    <div class="d-flex">
        <form method="get" class="d-flex mx-right w-25 mb-3" role="search">
            <input type="text" name="q" value="{{ request.GET.q }}" class="form-control me-2"
                   placeholder="{% trans '–ê—Ç—ã-–∂”©–Ω“Ø, —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–æ–º–µ—Ä–∏' %}">
            <button class="btn btn-outline-primary" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
        </form>
        <a href="{% url 'contacts_export_excel' %}" class="btn btn-success d-flex
            justify-content-between mb-3 ms-3">
            {% trans 'üì§ Excel —ç–∫—Å–ø–æ—Ä—Ç—Ç–æ–æ' %}
        </a>
    </div>


    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link {% if not selected_office %}active{% endif %}" href="{% url 'contacts' %}">
                {% trans '–ë–∞–∞—Ä—ã' %}
            </a>
        </li>
        {% for off in offices %}
        <li class="nav-item">
            <a class="nav-link {% if selected_office == off.id|stringformat:'s' %}active{% endif %}"
               href="?office={{ off.id }}">
                {{ off.name }}
            </a>
        </li>
        {% endfor %}
    </ul>

    <div class="table-responsive mt-3">
        <table class="table table-striped table-hover text-center align-middle">
            <thead class="table-primary">
            {% blocktrans %}
            <tr>
                <th>–ê—Ç—ã-–∂”©–Ω“Ø</th>
                <th>–ö—ã–∑–º–∞—Ç –æ—Ä–¥—É</th>
                <th>–ö—ã–∑–º–∞—Ç—Ç—ã–∫ —Ç–µ–ª–µ—Ñ–æ–Ω ‚Ññ</th>
                <th>”®–∫–º”©—Ç—Ç“Ø–∫/–∏—á–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω ‚Ññ</th>
                <th>–ú–æ–±–∏–ª–¥–∏–∫ —Ç–µ–ª–µ—Ñ–æ–Ω ‚Ññ</th>
                <th>–ö–∞–±–∏–Ω–µ—Ç ‚Ññ</th>
            </tr>
            {% endblocktrans %}
            </thead>
            <tbody>
            {% for item in departments_list %}
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞ -->
            <tr class="table-secondary" data-bs-toggle="collapse" data-bs-target=".dept-{{ item.dept.id }}"
                style="cursor:pointer;">
                <td colspan="6" class="text-start fw-bold">
                    {{ item.dept.name }}
                    <span class="badge bg-secondary ms-2">{{ item.employees|length }}</span>
                </td>
            </tr>

            {% if item.employees %}
            {% for emp in item.employees %}
            <tr class="collapse show dept-{{ item.dept.id }}">
                <td class="text-start">
                    {{ emp.profile.last_name }} {{ emp.profile.first_name }} {{ emp.profile.patronymic }}
                </td>
                <td>{{ emp.position.title }}</td>
                <td>{{ emp.profile.phone_number_work }}</td>
                <td>{{ emp.profile.phone_number_government }}</td>
                <td>{{ emp.profile.phone_number_mobile }}</td>
                <td>{{ emp.profile.office_number }}</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr class="collapse show dept-{{ item.dept.id }}">
                <td colspan="6" class="text-muted">{% trans '–ö—ã–∑–º–∞—Ç–∫–µ—Ä –∂–æ–∫' %}</td>
            </tr>
            {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
