{% load i18n %}
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <img src="/static/favicon/android-chrome-192x192.png"
                 alt="Logo" width="40" height="40" class="me-3">
            <span class="fw-bold">{% trans 'Справочник' %}</span>
        </a>

        <div class="dropdown ms-lg-3">
            <a class="d-flex align-items-center text-decoration-none dropdown-toggle"
               href="#" id="userMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {% if user.is_authenticated and user.profile.user_photo %}
                <span class="fw-semibold me-4">
                {% if user.first_name or user.last_name %}
                    {{ user.first_name }} {{ user.last_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
                </span>
                <img src="{{ user.profile.user_photo.url }}" alt="avatar"
                     class="rounded-circle me-2" width="32" height="32">
                {% else %}
                <i class="fa-solid fa-circle-user fa-2x me-2 text-primary"></i>
                {% endif %}
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userMenu">
                <li>
                    <a class="dropdown-item" href="{% url 'main_menu' %}">
                        <i class="fa-solid fa-house me-2"></i>{% trans 'Башкы бет' %}
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="{% url 'admin:index' %}" target="_blank">
                        <i class="fa-solid fa-sliders me-2"></i>{% trans 'Админ бөлүмү' %}
                    </a>
                </li>
                <li>
                    <form id="set-lang-form" action="{% url 'set_language' %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="{{ request.get_full_path }}">
                        {% if LANGUAGE_CODE == 'ky' %}
                        <input type="hidden" name="language" value="ru">
                        <button type="submit" class="dropdown-item">
                            <i class="fa-solid fa-language me-2"></i> Русский
                        </button>
                        {% else %}
                        <input type="hidden" name="language" value="ky">
                        <button type="submit" class="dropdown-item">
                            <i class="fa-solid fa-language me-2"></i> Кыргызча
                        </button>
                        {% endif %}
                    </form>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <form method="post" action="{% url 'logout' %}" class="d-inline">
                        {% csrf_token %}
                        <button class="dropdown-item text-danger" type="submit">
                            <i class="fa-solid fa-right-from-bracket me-2"></i>{% trans 'Чыгуу' %}
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
    (function() {
      function getCurrentLang() {
        return "{{ LANGUAGE_CODE }}";  // шаблонная подстановка
      }

      const toggle = document.getElementById('lang-toggle');
      const input = document.getElementById('language-input');
      const form = document.getElementById('language-form');

      toggle.addEventListener('click', function (e) {
        e.preventDefault();
        const current = getCurrentLang();
        const newLang = current === 'ky' ? 'ru' : 'ky';
        input.value = newLang;
        form.submit();  // отправит POST на set_language
      });
    })();
</script>